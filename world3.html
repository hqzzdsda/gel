<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡£æ¡ˆ IIIï¼šçº¢è–¯æ·€ç²‰çš„æˆ˜æœ¯çº§åº”ç”¨</title>
    <style>
        /* --- å…¨å±€æ ·å¼ (å†»åœŸä¸ç‚‰ç«é£æ ¼) --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #1a1512; /* æ·±è¤è‰²ï¼Œåƒå†»åœŸ */
            font-family: "Microsoft YaHei", "SimHei", sans-serif;
            overflow: hidden;
            color: #d7ccc8; /* ç±³ç™½è‰²æ–‡å­—ï¼Œåƒæ—§çº¸ */
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        #background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 1;
            transition: opacity 2s ease, filter 2s ease;
            opacity: 0;
            /* ç¨å¾®åŠ ä¸€ç‚¹å¯¹æ¯”åº¦ï¼Œä½“ç°å¯’å†· */
            filter: contrast(1.1) brightness(0.9); 
        }

        /* è§’è‰²ç«‹ç»˜ */
        #character {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            height: 85%; /* é›¨å§æ°”åœºå¤§ï¼Œç«‹ç»˜å¯ä»¥ç¨å¤§ */
            width: auto;
            z-index: 2;
            transition: opacity 1.5s ease;
            opacity: 0;
        }
        
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 5;
            pointer-events: none;
            transition: opacity 1.5s;
        }

        /* å¯¹è¯æ¡† (æ— è¾¹æ¡†æ²‰æµ¸å¼) */
        #dialogue-box {
            position: relative;
            width: 90%;
            max-width: 1000px;
            height: 260px;
            /* é»‘è‰²åˆ°æ·±çº¢è¤è‰²çš„æ¸å˜ï¼Œæ¨¡æ‹Ÿç‚‰ç«è¾¹çš„é˜´å½± */
            background: linear-gradient(180deg, rgba(26, 21, 18, 0) 0%, rgba(20, 10, 5, 0.9) 20%, rgba(10, 5, 0, 1) 100%);
            z-index: 10;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            margin-bottom: 20px;
            
            /* ã€æ— è¾¹æ¡†ã€‘ä¿æŒé€šé€ */
            border: none; 
            
            opacity: 0;
            transition: opacity 0.5s;
        }

        #name-tag {
            font-size: 26px;
            font-weight: 900; /* åŠ ç²— */
            color: #ff5722; /* åƒç‚­ç«ä¸€æ ·çš„æ©˜çº¢è‰² */
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 87, 34, 0.3);
        }

        #text-content {
            font-size: 21px;
            line-height: 1.7;
            letter-spacing: 1.5px;
            color: #efebe9;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        /* ç³»ç»Ÿæç¤ºæ¡† (æœ´ç´ é£æ ¼) */
        .system-message-container {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            background: rgba(10, 10, 10, 0.9);
            border-top: 2px solid #ff5722; /* åªæœ‰é¡¶ä¸Šä¸€æ¡çº¢çº¿ */
            border-bottom: 2px solid #ff5722;
            color: #ffccbc;
            padding: 25px;
            text-align: center;
            z-index: 20;
            font-family: "SimHei", monospace; /* é»‘ä½“æ›´åƒå¤§å­—æŠ¥ */
            display: none;
        }

        /* é€‰é¡¹æ ·å¼ (åšé‡æ„Ÿ) */
        #choices-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 30;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 25px;
        }

        .choice-btn {
            background: linear-gradient(90deg, #3e2723, #212121);
            border: none;
            border-left: 4px solid #8d6e63; /* å·¦ä¾§åœŸè‰²ç²—çº¿ */
            color: #efebe9;
            padding: 20px 40px;
            font-size: 20px;
            cursor: pointer;
            width: 70%;
            max-width: 500px;
            transition: all 0.3s;
            text-align: left; /* æ–‡å­—å·¦å¯¹é½ï¼Œæ›´æœ‰å™äº‹æ„Ÿ */
            padding-left: 30px;
        }

        .choice-btn:hover {
            background: #5d4037;
            border-left-color: #ff5722; /* æ‚¬åœå˜çº¢ */
            color: #fff;
            transform: translateX(10px); /* å‘å³åŠ¨ä¸€ä¸‹ */
        }

        #click-catcher {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 25;
            cursor: pointer;
        }
        
        .return-btn {
            margin-top: 30px;
            background: #ff5722;
            color: #fff;
            text-align: center;
            font-weight: bold;
        }
        .return-btn:hover {
            background: #e64a19;
            transform: none;
        }

    </style>
</head>
<body>

<div id="game-container">
    <div id="background"></div>
    <img id="character" src="" alt="Character">
    <div id="overlay"></div>

    <div id="system-box" class="system-message-container">
        <div id="system-content" class="system-text"></div>
    </div>

    <div id="choices-container"></div>

    <div id="dialogue-box">
        <div id="name-tag"></div>
        <div id="text-content"></div>
    </div>

    <div id="click-catcher" onclick="nextStep()"></div>
</div>

<script>
    // --- æ¸¸æˆçŠ¶æ€ ---
    let currentStepIndex = 0;
    let isTyping = false;
    let typeInterval;
    
    // æ ¸å¿ƒæ•°å€¼ï¼šAcknowledge (é¢å¯¹/ç«™ä½) vs Deny (å¦è®¤/é€ƒé¿)
    let scores = {
        acknowledge: 0,
        deny: 0
    };

    // --- èµ„æºè·¯å¾„ (è¯·æ›¿æ¢å›¾ç‰‡) ---
    const ASSETS = {
        bg_yard: './images3/bgyardwinter.png',   // å†¬å¤©é™¢å­
        bg_kitchen: './images3/bgkitchen.png',    // ç¶æˆ¿
        bg_money: './images3/bgnightmoney.png',  // ç¯ä¸‹æ•°é’±
        bg_work: './images3/bgconstruction.png',  // å·¥åœ°/åŸå¸‚è¾¹ç¼˜
        bg_gate: './images3/bgsnowgate.png',     // é›ªåœ°å¤§é—¨
        char_yujie: './images3/charyujie.png'     // é›¨å§
    };

    // --- å‰§æœ¬ ---
    const storyScript = [
        // â–¶ W03-Scene 0ï½œè¿›å…¥
        { type: 'system', text: "è½¬ç”Ÿè·¯å¾„ç¡®è®¤ä¸­â€¦â€¦" },
        { type: 'system', text: "å½“å‰èº«ä»½ï¼šå·²åˆ†é…ã€‚\nè®°å¿†é™åˆ¶ï¼šå¯ç”¨ã€‚" },
        { type: 'system', text: "è½¬ç”Ÿå®Œæˆã€‚", bgAction: 'fadeIn', bgSrc: ASSETS.bg_yard },

        // â–¶ W03-Scene 1ï½œå±¯å­ Â· æ—¥å­
        { type: 'narrative', text: "æˆ‘å«è€å¿«ã€‚\nè¿™åä¸æ˜¯æˆ‘èµ·çš„ã€‚\næ˜¯å±¯é‡Œäººå«é¡ºå˜´çš„ã€‚" },
        { type: 'narrative', text: "å¹²æ´»å¿«ã€‚\nè®¤å‘½ä¹Ÿå¿«ã€‚" },
        { type: 'narrative', text: "å°é›¨ä¸æ˜¯æˆ‘åª³å¦‡é‚£é˜µï¼Œ\næ•´ä¸ªå±¯å­å°±æ²¡äººæ•¢æƒ¹å¥¹ã€‚" },
        { type: 'narrative', text: "è¯´è¯è·ŸåŠˆæŸ´ä¼¼çš„ï¼Œ\nä¸€ä¸‹ä¸€ä¸ªå“ã€‚\nèµ°è·¯å¤§è„šè¸©åœ°ï¼Œ\nåƒç»™è¿™ç‰‡åœŸç›–æˆ³ã€‚" },
        { type: 'narrative', text: "æˆ‘åå°±åƒå¥¹è¿™ä¸€å¥—ã€‚" },

        // ğŸ”¹ Choice 1
        { 
            type: 'choice',
            question: "ã€åˆå°è±¡ã€‘ä½ æ€ä¹ˆçœ‹å¥¹ï¼Ÿ",
            choices: [
                { text: "A. å¥¹å‰å®³ï¼Œæˆ‘å¾—èº²ç€ç‚¹", effect: { deny: 1 } },
                { text: "B. å¥¹å‰å®³ï¼Œæˆ‘é å¾—ä½", effect: { ack: 1 } },
                { text: "C. å¥¹å‰å®³ï¼Œæˆ‘é…ä¸ä¸Š", effect: { deny: 1 } }
            ]
        },
        { type: 'system', text: "è¾“å…¥å·²æ¥æ”¶ã€‚" },

        // â–¶ W03-Scene 2ï½œç²‰æ¡ Â· ç¨³å®š
        { type: 'narrative', text: "ç¶ç«çƒ§å¾—æ—ºã€‚", bgAction: 'change', bgSrc: ASSETS.bg_kitchen },
        { type: 'narrative', text: "å¥¹ä¸€åšçº¢è–¯ç²‰æ¡ï¼Œ\næˆ‘å°±è·Ÿç€è½¬ã€‚", charAction: 'show', charSrc: ASSETS.char_yujie },
        { type: 'narrative', text: "ç²‰é¢å’Œæ°´ä¸€æºï¼Œ\nå¥¹èƒ³è†Šä¸€æŠ¡ï¼Œ\nç›†â€œå“â€åœ°ä¸€å£°ã€‚" },
        { type: 'narrative', text: "æˆ‘å¿ƒå°±å®šäº†ã€‚\nåˆ«äººçœ‹çš„æ˜¯åƒçš„ã€‚\næˆ‘çœ‹çš„æ˜¯å¥¹ç«™é‚£å„¿â€”â€”" },
        { type: 'narrative', text: "ç¨³ï¼Œ\nç‹ ï¼Œ\nåƒä¸ªèƒ½æŒ¡é£çš„ä¸œè¥¿ã€‚" },

        // ğŸ”¹ Choice 2
        { 
            type: 'choice',
            question: "ã€å†…å¿ƒã€‘ä½ å¯¹è¿™ä»½â€œç¨³â€çš„æ€åº¦ï¼Ÿ",
            choices: [
                { text: "A. è¿™æ ·æŒºå¥½ï¼Œä¸æŠ˜è…¾äº†", effect: { ack: 1 } },
                { text: "B. æ—¥å­ä¹…äº†ï¼Œæœ‰ç‚¹æ†‹", effect: { deny: 1 } },
                { text: "C. æˆ‘å¾—è¯æ˜ç‚¹ä»€ä¹ˆ", effect: { deny: 1 } }
            ]
        },
        { type: 'system', text: "è¡Œä¸ºè®°å½•ä¸­â€¦â€¦" },

        // â–¶ W03-Scene 3ï½œæ—¥å­ç´§äº†
        { type: 'narrative', text: "ç§‹åã€‚", bgAction: 'change', bgSrc: ASSETS.bg_money, charAction: 'hide' },
        { type: 'narrative', text: "ç²‰æ¡å–å¾—æ…¢ã€‚\né’±å‹åœ¨å±‹é‡Œã€‚\næˆ‘çˆ¹åœ¨å¤–å¤´æ¬ äº†è´¦ã€‚\näººå®¶ä¸Šé—¨å‚¬ã€‚" },
        { type: 'narrative', text: "æˆ‘è„¸è®©äººè¸©è¿›åœ°é‡Œã€‚" },
        { type: 'narrative', text: "å¥¹ä¸€å¥æ€¨è¨€æ²¡æœ‰ã€‚\næ™šä¸Šç‚¹ç¯æ•°é’±ã€‚\næ•°åˆ°æœ€åä¸€å¼ ï¼Œ\nå¥¹æŠ¬å¤´çœ‹æˆ‘ã€‚", charAction: 'show', charSrc: ASSETS.char_yujie },
        
        { type: 'dialogue', name: 'å°é›¨', text: "è€å¿«ï¼Œä½ è¦æ˜¯èµ°ï¼Œæˆ‘ä¸æ‹¦ã€‚\nä½†ä½ è¦èµ°ä¸æ˜ç™½ï¼Œ\nå°±åˆ«å›æ¥ä¸¢äººã€‚" },

        // ğŸ”¹ Choice 3
        { 
            type: 'choice',
            question: "ã€å¬è¯å¬éŸ³ã€‘è¿™è¯è½ä½ å¿ƒé‡Œæ˜¯ï¼Ÿ",
            choices: [
                { text: "A. å¥¹ç§ä¸èµ·æˆ‘", effect: { deny: 1 } },
                { text: "B. å¥¹ç»™æˆ‘ç•™è·¯ï¼ˆä¹Ÿæ˜¯ç•™é—¨ï¼‰", effect: { ack: 1 } },
                { text: "C. æˆ‘å¬ä¸è¿›å»", effect: { deny: 1 } }
            ]
        },
        { type: 'system', text: "è®°å½•å·²æ›´æ–°ã€‚" },

        // â–¶ W03-Scene 4ï½œå¤–å¤´ Â· è´¥ä»—
        { type: 'narrative', text: "æˆ‘å’¬ç‰™å‡ºå»æ‰“å·¥ã€‚", bgAction: 'change', bgSrc: ASSETS.bg_work, charAction: 'hide' },
        { type: 'narrative', text: "ç¬¬ä¸€ç«™ï¼Œç –å‚ã€‚\næ‰‹ç£¨å¾—å…¨æ˜¯è¡€æ³¡ã€‚" },
        { type: 'narrative', text: "ç¬¬äºŒç«™ï¼Œå·¥åœ°ã€‚\nè€æ¿è·‘äº†ã€‚" },
        { type: 'narrative', text: "é’±æ²¡æŒ£ç€ã€‚\nè„¸å…ˆæ²¡äº†ã€‚" },

        // ğŸ”¹ Choice 4
        { 
            type: 'choice',
            question: "ã€è‡³æš—æ—¶åˆ»ã€‘ä½ æƒ³èµ·å¥¹æ—¶ï¼Ÿ",
            choices: [
                { text: "A. æƒ³å›å»", effect: { ack: 1 } },
                { text: "B. ä¸èƒ½å›ï¼Œå¤ªä¸¢äºº", effect: { deny: 1 } },
                { text: "C. å†ç†¬ç†¬çœ‹", effect: { deny: 1 } }
            ]
        },
        { type: 'system', text: "è¾“å…¥å·²æ¥æ”¶ã€‚" },

        // â–¶ W03-Scene 5ï½œä¼ è¯ Â· å¿ƒé»‘äº†
        { type: 'narrative', text: "å±¯é‡Œä¼ è¯æ¯”é£è¿˜å¿«ã€‚" },
        { type: 'narrative', text: "æœ‰äººè¯´æˆ‘æ··ä¸ä¸‹å»ã€‚\næœ‰äººè¯´å¥¹ä¸ç¼ºæˆ‘ã€‚\nè¿˜æœ‰äººè¯´â€”â€”" },
        { type: 'narrative', text: "å¥¹é‚£åŒå¤§è„šï¼Œ\næ—©æ™šè¸©åˆ«äººå®¶é—¨æ§›ã€‚" },
        { type: 'narrative', text: "æˆ‘å¿ƒä¸€ä¸‹å°±é»‘äº†ã€‚" },

        // ğŸ”¹ Choice 5
        { 
            type: 'choice',
            question: "ã€æµè¨€ã€‘ä½ ä¿¡ä¸ä¿¡è¿™äº›è¯ï¼Ÿ",
            choices: [
                { text: "A. ä¿¡äº†", effect: { deny: 1 } },
                { text: "B. åŠä¿¡åŠç–‘", effect: { deny: 1 } },
                { text: "C. ä¸ä¿¡ï¼Œä½†æ€•", effect: { ack: 1 } }
            ]
        },
        { type: 'system', text: "è¾“å…¥å·²æ¥æ”¶ã€‚" },

        // â–¶ W03-Scene 6ï½œå›å®¶ Â· ç²‰æ¡æ–­äº†
        { type: 'narrative', text: "å›å»é‚£å¤©ï¼Œæˆ‘æ˜¯å–äº†é…’çš„ã€‚", bgAction: 'change', bgSrc: ASSETS.bg_gate },
        { type: 'narrative', text: "é™¢é—¨ä¸€å¼€ã€‚\nå¥¹æ­£æ™¾ç²‰æ¡ã€‚\nç™½èŠ±èŠ±ä¸€æ’ã€‚", charAction: 'show', charSrc: ASSETS.char_yujie },
        { type: 'dialogue', name: 'å°é›¨', text: "ä½ å›æ¥å¹²å•¥ï¼Ÿ" },
        { type: 'narrative', text: "æˆ‘å˜´æ¯”è„‘å­å¿«ã€‚\nè¯´äº†ä¸è¯¥è¯´çš„ã€‚" },
        { type: 'narrative', text: "å¥¹æ²¡åµã€‚\næ²¡å“­ã€‚\nåªæŠŠæ‰‹é‡Œçš„ç²‰æ¡å‰ªæ–­ã€‚\nä¸€æˆªä¸€æˆªæ‰åœ°ä¸Šã€‚" },
        { type: 'dialogue', name: 'å°é›¨', text: "è¿™é”…ç²‰æ¡ï¼Œ\nä½ å†ä¹Ÿåˆ«åƒäº†ã€‚" },

        // ğŸ”¹ Choice 6 (Final Attitude)
        { 
            type: 'choice',
            question: "ã€å†³æ–­ã€‘è¿™ä¸€åˆ»ï¼Œä½ æ€ä¹ˆç«™ï¼Ÿ",
            choices: [
                { text: "A. ä½å¤´è®¤äº†", effect: { ack: 1 } },
                { text: "B. ç¡¬æ’‘ä¸€å¥", effect: { deny: 1 } },
                { text: "C. ä»€ä¹ˆä¹Ÿä¸è¯´", effect: { deny: 1 } }
            ]
        },
        { type: 'system', text: "å½“å‰è·¯å¾„å€¾å‘ï¼šå·²é”å®šã€‚" },

        // ç»“å±€åˆ¤å®šç‚¹
        { type: 'logic_check' }
    ];

    // --- å¼•æ“é€»è¾‘ (å¤ç”¨) ---
    const bgEl = document.getElementById('background');
    const charEl = document.getElementById('character');
    const overlayEl = document.getElementById('overlay');
    const nameTagEl = document.getElementById('name-tag');
    const textContentEl = document.getElementById('text-content');
    const dialogueBoxEl = document.getElementById('dialogue-box');
    const systemBoxEl = document.getElementById('system-box');
    const systemContentEl = document.getElementById('system-content');
    const choicesContainerEl = document.getElementById('choices-container');

    function nextStep() {
        if (isTyping) { finishTyping(); return; }
        if (currentStepIndex >= storyScript.length) return;

        const step = storyScript[currentStepIndex];

        if (step.type === 'logic_check') {
            resolveEnding();
            return;
        }

        handleEffects(step);

        if (step.type === 'choice') {
            showChoices(step);
        } else if (step.type === 'system') {
            showSystemMessage(step.text);
            currentStepIndex++;
        } else {
            showDialogue(step);
            currentStepIndex++;
        }
    }

    function handleEffects(step) {
        if (step.bgAction === 'fadeIn') {
            overlayEl.style.opacity = 0;
            bgEl.style.opacity = 1;
            if(step.bgSrc) bgEl.style.backgroundImage = `url('${step.bgSrc}')`;
        } else if (step.bgAction === 'change') {
            if(step.bgSrc) bgEl.style.backgroundImage = `url('${step.bgSrc}')`;
        }
        
        if (step.charAction === 'show') {
            charEl.style.opacity = 1;
            if(step.charSrc) charEl.src = step.charSrc;
        } else if (step.charAction === 'hide') {
            charEl.style.opacity = 0;
        }
    }

    function showDialogue(step) {
        systemBoxEl.style.display = 'none';
        dialogueBoxEl.style.opacity = 1;
        
        if (step.name) {
            nameTagEl.innerText = step.name;
            nameTagEl.style.display = 'block';
        } else {
            nameTagEl.style.display = 'none';
        }
        typeWriter(step.text.replace(/\n/g, '<br>'), textContentEl);
    }

    function showSystemMessage(text) {
        dialogueBoxEl.style.opacity = 0;
        systemBoxEl.style.display = 'block';
        typeWriter(text, systemContentEl);
    }

    function showChoices(step) {
        choicesContainerEl.style.display = 'flex';
        choicesContainerEl.innerHTML = '';
        
        const title = document.createElement('h2');
        title.innerText = step.question;
        title.style.color = '#d7ccc8';
        title.style.marginBottom = '20px';
        choicesContainerEl.appendChild(title);

        step.choices.forEach(choice => {
            const btn = document.createElement('div');
            btn.className = 'choice-btn';
            btn.innerText = choice.text;
            btn.onclick = (e) => {
                e.stopPropagation();
                if (choice.effect) {
                    if (choice.effect.ack) scores.acknowledge += choice.effect.ack;
                    if (choice.effect.deny) scores.deny += choice.effect.deny;
                }
                choicesContainerEl.style.display = 'none';
                currentStepIndex++;
                nextStep();
            };
            choicesContainerEl.appendChild(btn);
        });
    }

    function resolveEnding() {
        dialogueBoxEl.style.opacity = 1;
        nameTagEl.style.display = 'none';
        systemBoxEl.style.display = 'none';
        
        let endTitle = "";
        let endText = "";

        // ç»“å±€åˆ¤å®š
        if (scores.acknowledge > scores.deny) {
            // âœ… ç»“å±€ä¸€
            endTitle = "ã€ç»“å±€ï¼šä½å¤´ä¸ä¸¢äººã€‘";
            endText = "æˆ‘æ²¡èµ°ï¼Œåœ¨é™¢é‡Œè·ªäº†ä¸€å®¿ã€‚<br>é›ªä¸‹åˆ°è„–å­ã€‚<br>ç¬¬äºŒå¤©ï¼Œå¥¹å‡ºæ¥å€’ç°ï¼Œçœ‹è§æˆ‘ã€‚<br>â€œè¿›å±‹ã€‚â€<br><br>åæ¥æˆ‘å†æ²¡æèµ°çš„äº‹ã€‚<br>æœ‰å¤©å¤œé‡Œï¼Œå¥¹æŠŠç²‰æ¡ç«¯ç»™æˆ‘ï¼š<br>â€œæˆ‘èƒ½å…»ä½ ï¼Œä½†ä½ å¾—ç«™ç›´äº†è®©æˆ‘å…»ã€‚â€<br><br>æˆ‘ç‚¹å¤´ã€‚<br>è¿™è¾ˆå­ï¼Œæˆ‘å°±ç«™åœ¨å¥¹è¿™åŒå¤§è„šåå¤´ã€‚";
        } else {
            // âŒ ç»“å±€äºŒ
            endTitle = "ã€ç»“å±€ï¼šè°éƒ½ä¸æ¬ è°ã€‘";
            endText = "æˆ‘è¿˜æ˜¯èµ°äº†ã€‚<br>åæ¥æˆ‘åœ¨å¤–åœ°ç«™ç¨³äº†è„šã€‚<br>å†å›å±¯å­ï¼Œäººä¸åœ¨äº†ã€‚<br>å¬è¯´å¥¹ç”Ÿæ„åšå¤§äº†ï¼Œä¹Ÿå¬è¯´å¥¹å†æ²¡ç»™è°ç››è¿‡å¤šä¸€ç­·å­ã€‚<br><br>æˆ‘ç«™åœ¨é™¢å¤–ï¼Œæ‰æ˜ç™½ï¼š<br><span style='color:#ff5722'>æœ‰äº›å¥³äººï¼Œä½ ä¸€æ—¦æ²¡è·Ÿä½å¥¹çš„æ­¥å­ï¼Œ<br>å°±æ°¸è¿œè¿½ä¸ä¸Šäº†ã€‚</span>";
        }

        textContentEl.innerHTML = `<h3 style='color:#ff5722'>${endTitle}</h3><p>${endText}</p>`;
        
        markWorldCleared("world3"); // æ ‡è®° World 3 é€šå…³

        setTimeout(() => {
            const returnBtn = document.createElement('button');
            returnBtn.className = 'choice-btn return-btn';
            returnBtn.innerText = "ä¸–ç•Œçº¿æ”¶æŸ Â· è¿”å›ä¸­è½¬ç«™";
            returnBtn.onclick = () => {
                window.location.href = './index.html?skipIntro=true';
            };
            textContentEl.appendChild(returnBtn);
        }, 1500);
    }

    function markWorldCleared(worldId) {
        const SAVE_KEY = "reborn_game_cleared_worlds";
        let clearedWorlds = JSON.parse(localStorage.getItem(SAVE_KEY)) || [];
        if (!clearedWorlds.includes(worldId)) {
            clearedWorlds.push(worldId);
            localStorage.setItem(SAVE_KEY, JSON.stringify(clearedWorlds));
        }
    }

    function typeWriter(htmlText, targetElement) {
        isTyping = true;
        let fullText = htmlText;
        targetElement.innerHTML = '';
        let i = 0;
        clearInterval(typeInterval);
        
        typeInterval = setInterval(() => {
            if (i >= fullText.length) { finishTyping(); return; }
            if (fullText[i] === '<') {
                const closeIndex = fullText.indexOf('>', i);
                targetElement.innerHTML += fullText.substring(i, closeIndex + 1);
                i = closeIndex + 1;
            } else {
                targetElement.innerHTML += fullText[i];
                i++;
            }
        }, 40);
    }

    function finishTyping() {
        clearInterval(typeInterval);
        isTyping = false;
    }

    // å¯åŠ¨
    nextStep();

</script>
</body>
</html>
